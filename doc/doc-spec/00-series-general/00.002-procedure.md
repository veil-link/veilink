# 00.002 Procedure

## 1. Controller Start/Stop

### 1.1 Controller Start

```mermaid
sequenceDiagram
    autonumber

    participant amf as AMF
    participant smf as SMF
    participant pkf as PKF
    participant nsf as NSF
    participant drf as DRF
    participant oam as OAM

    nsf ->>+ nsf: NNSF_NF_REGISTERATION_REQUEST
    nsf -->>- nsf: NNSF_NF_REGISTERATION_ACCEPT

    par
        amf ->>+ nsf: NNSF_NF_REGISTERATIONR_REQUEST
        nsf -->>- amf: NNSF_NF_REGISTERATION_ACCEPT
    and
        smf ->>+ nsf: NNSF_NF_REGISTERATION_REQUEST
        nsf -->>- smf: NNSF_NF_REGISTERATION_ACCEPT
    and
        pkf ->>+ nsf: NNSF_NF_REGISTERATION_REQUEST
        nsf -->>- pkf: NNSF_NF_REGISTERATION_ACCEPT
    and
        drf ->>+ nsf: NNSF_NF_REGISTERATION_REQUEST
        nsf -->>- drf: NNSF_NF_REGISTERATION_ACCEPT
    and
        oam ->>+ nsf: NNSF_NF_REGISTERATION_REQUEST
        nsf -->>- oam: NNSF_NF_REGISTERATION_ACCEPT
    end
```

### 1.2 Controller Stop

```mermaid
sequenceDiagram
    autonumber

    participant amf as AMF
    participant smf as SMF
    participant pkf as PKF
    participant nsf as NSF
    participant drf as DRF
    participant oam as OAM

    par
        oam ->>+ nsf: NNSF_NF_DE_REGISTERATION_REQUEST
        nsf -->>- oam: NNSF_NF_DE_REGISTERATION_ACCEPT
    and
        drf ->>+ nsf: NNSF_NF_DE_REGISTERATION_REQUEST
        nsf -->>- drf: NNSF_NF_DE_REGISTERATION_ACCEPT
    and
        pkf ->>+ nsf: NNSF_NF_DE_REGISTERATION_REQUEST
        nsf -->>- pkf: NNSF_NF_DE_REGISTERATION_ACCEPT
    and
        smf ->>+ nsf: NNSF_NF_DE_REGISTERATION_REQUEST
        nsf -->>- smf: NNSF_NF_DE_REGISTERATION_ACCEPT
    and
        amf ->>+ nsf: NNSF_NF_DE_REGISTERATIONR_REQUEST
        nsf -->>- amf: NNSF_NF_DE_REGISTERATIONR_ACCEPT
    end

    nsf ->>+ nsf: NNSF_NF_DE_REGISTERATION_REQUEST
    nsf -->>- nsf: NNSF_NF_DE_REGISTERATION_ACCEPT
```

## 2. NF Start/Stop

### 2.1 NF Start

```mermaid
graph LR
    Y(NF Started)
    Z(Exit)

    A(Start NF) -->  B[Load Configurations]
    B -- Success --> C[Logger Setup]
    B -- Fail --> Z
    C -- Success --> D[Start SBI Server]
    C -- Fail --> Z
    D -- Success --> E[Register to NSF]
    D -- Fail --> Z
    E -- Success --> F{Has NX Interface?}
    E -- Fail --> Z
    F -- Yes --> G[Setup NX Interface]
    F -- No --> Y
    G -- Success --> Y
    G -- Faile --> Z
```

### 2.2 NF Stop

```mermaid
graph LR
    Z(NF Stopped)

    A(Stop NF) --> B{Has NX Interface}
    B -- Yes --> C[Close NX Interface]
    B -- No --> D[De-register to NSF]
    C --> D
    D --> E[Stop SBI Server]
    E --> Z
```

## 3. NF Service Access

```mermaid
sequenceDiagram
    autonumber
    participant con as Consumer
    participant nsf as NSF
    participant pro as Processor

    con ->>+ nsf: NNSF_NF_DISCOVERY_REQUEST
    nsf -->>- con: NNSF_NF_DISCOVERY_REPLY
    con ->>+ pro: NXXX_SERVICE_REQUEST
    pro -->- con: NXXX_SERVICE_REPLY
```

## 4. Identity Initialization/Registeration/De-registeration

### 4.1 Identity Initialization

```mermaid
sequenceDiagram
    autonumber

    participant id as Identity
    participant amf as AMF
    participant pkf as PKF
    participant drf as DRF
    participant oam as OAM

    oam ->>+ drf: NDRF_IDENTITY_STORAGE_RQUEST
    drf -->>- oam: NDRF_IDENTITY_STORAGE_ACK
    oam ->>+ pkf: NPKF_JWT_GENERATION_REQUEST
    pkf -->>- oam: NPKF_JWT_GENERATION_REPLY
    oam ->>+ drf: NDRF_JWT_STORAGE_REQUEST
    drf -->>- oam: NDRF_JWT_STORAGE_ACK

    id <<->> oam: Download JWT

    id ->>+ amf: IAP_INITIALZATION_REQUEST
    amf ->>+ pkf: NPKF_JWT_VALIDATION_REQUEST
    pkf ->>+ drf: NDRF_JWT_QUERY_REQUEST
    drf -->>- pkf: NDRF_JWT_QUERY_REPLY
    pkf -->>- amf: NPKF_JWT_VALIDATION_REPLY
    amf ->>+ pkf: NPKF_CERT_GENERATION_REQUEST
    pkf -->>- amf: NPKF_CERT_GENERATION_REPLY
    amf -->>- id: IAP_INITIALZATION_ACCEPT
```

### 4.2 Identity Registration

```mermaid
sequenceDiagram
    autonumber

    participant id as Identity
    participant amf as AMF
    participant pkf as PKF
    participant drf as DRF

    id ->>+ amf: IAP_REGISTRATION_REQUEST
    amf ->>+ pkf: NPKF_CERT_VALIDATION_REQUEST
    pkf ->>+ drf: NDRF_IDENTITY_UPDATE_REQUEST
    drf -->>- pkf: NDRF_IDENTITY_UPDATE_ACK
    pkf -->>- amf: NPKF_CERT_VALIDATION_ACK
    amf -->>- id: IAP_REGISTRATION_ACCEPT
```

### 4.3 Identity De-registration

```mermaid
sequenceDiagram
    autonumber

    participant id as Identity
    participant amf as AMF
    participant pkf as PKF

    id ->>+ amf: IAP_DE_REGISTRATION_REQUEST
    amf ->>+ pkf: NPKF_CERT_VALIDATION_REQUEST
    pkf -->>- amf: NPKF_CERT_VALIDATION_ACK
    amf -->>- id: IAP_DE_REGISTRATION_ACCEPT
```

## 5. Session Establishment/Modification/Release

### 5.1 Session Establishment

### 5.2 Session Modification

### 5.3 Session Release

## 6. OAM Real-time Monitoring

## 7. QUIC Forward
