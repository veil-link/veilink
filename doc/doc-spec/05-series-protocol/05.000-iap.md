# 05.000 IAP (Identity Access Protocol)

## 1. Introduction

IAP (Identity Access Protocol) is used at N1 interface between AMF and identities, which is based on SCTP connection.

## 2. IAP PDU

### 2.1 PDU

IAP PDU (Packet Data Unit) is used for formatting th IAP packet during transfer both request and response.

```go
type IapPdu struct {
    Present int `msgpack:"present"`
    Payload interface{} `msgpack:"payload,omitempty"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| Present | int | M | Indicate the IAP PDU type. |
| Payload | any | O | The actual IAP data. |

### 2.2 PDU Encode/Decode

With `msgpack` tag, IAP PDU can use [Message Pack](https://github.com/vmihailenco/msgpack) to encode and decode the messages.

## 3. IAP Prensent

```go
const (
    IAP_RESERVED_EMPTY_MSG = 0
    IAP_INITIALIZATION_REQUEST = 1
    IAP_INITIALIZATION_ACCEPT = 2
    IAP_INITIALIZATION_REJECT = 3
    IAP_REGISTRATION_REQUEST = 4
    IAP_REGISTRATION_ACCEPT = 5
    IAP_REGISTRATION_REJECT = 6
    IAP_DE_REGISTRATION_REQUEST = 7
    IAP_DE_REGISTRATION_ACCEPT = 8
    IAP_DE_REGISTRATION_REJECT = 9
)
```

| Present Type | Present Value |
| - | - |
| IAP_RESERVED_EMPTY_MSG | 0 |
| IAP_INITIALIZATION_REQUEST | 1 |
| IAP_INITIALIZATION_ACCEPT | 2 |
| IAP_INITIALIZATION_REJECT | 3 |
| IAP_REGISTRATION_REQUEST | 4 |
| IAP_REGISTRATION_ACCEPT | 5 |
| IAP_REGISTRATION_REJECT | 6 |
| IAP_DE_REGISTRATION_REQUEST | 7 |
| IAP_DE_REGISTRATION_ACCEPT | 8 |
| IAP_DE_REGISTRATION_REJECT | 9 |

## 4. IAP Model

### 4.1 Identity Initialization

Request:

- [IAP_INITIALZATION_REQUEST](#51-iap_initialization_request)

Response:

- [IAP_INITIALIZATION_ACCEPT](#52-iap_initialization_accept)
- [IAP_INITIALIZATION_REJECT](#53-iap_initialization_reject)

### 4.2 Identity Registration

Request:

- [IAP_REGISTRATION_REQUEST](#56-iap_registration_request)

Response:

- [IAP_REGISTRATION_ACCEPT](#57-iap_registration_accept)
- [IAP_REGISTRATION_REJECT](#58-iap_registration_reject)

### 4.3 Identity De-registration

Request:

- [IAP_DE_REGISTRATION_REQUEST](#511-iap_de_registration_request)

Response:

- [IAP_DE_REGISTRATION_ACCEPT](#512-iap_de_registration_accept)
- [IAP_DE_REGISTRATION_REJECT](#513-iap_de_registration_reject)

## 5. Appendix

### 5.1 IAP_INITIALIZATION_REQUEST

```go
type InitializationRequest struct {
    Jwt string `msgpack:"jwt"`
    IdentityPublicKey string `msgpack:"identity_public_key"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| Jwt | string | M | The one-time initialization JWT obtained from OAM or administrator, which contains the controller's public encryption key. |
| IdentityPublicKey | string | M | The identity's public key for the controller to encrypt the IAP PDU before sending the initialization accept message. |

### 5.2 IAP_INITIALIZATION_ACCEPT

```go
type InitializationAccept struct {
    Certificate string `msgpack:"certificate"`
    IdentityInformation IdentityInformation `msgpack:"identity_information"`
    AccessKey string `msgpack:"access_key"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| Certificate | string | M | The certificate for the identity to obtain authorization in the Veil-link system. |
| IdentityInformation | [IdentityInformation](#54-iap_identity_information) | M | Identity information setup via OAM. |
| AccessKey | string | M | The symmetric key used to encrypt IAP PDUs in subsequent communications. |

### 5.3 IAP_INITIALIZATION_REJECT

```go
type InitializationReject struct {
    RejectCause RejectCause `msgpack:"reject_cause"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| RejectCause | [RejectCause](#55-iap_reject_cause) | M | The cause of rejection. |

### 5.4 IAP_IDENTITY_INFORMATION

```go
type IdentityInformation struct {
    Name string `msgpack:"name"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| Name | string | M | Identity name setup at OAM. |

### 5.5 IAP_REJECT_CAUSE

```go
type RejectCause struct {
    Cause string `msgpack:"cause"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| Cause | string | M | The failure description. |

### 5.6 IAP_REGISTRATION_REQUEST

```go
type RegistrationRequest struct {
    IdentityInformation IdentityInformation `msgpack:"identity_information"`
    Certificate string `msgpack:"certificate"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| IdentityInformation | [IdentityInformation](#54-iap_identity_information) | M | Identity name setup at OAM. |
| Certificate | string | M | The certificate received from initialization procedure from PKF. |

### 5.7 IAP_REGISTRATION_ACCEPT

```go
type RegistrationAccept struct {
    ServiceList []ServiceInformation `msgpack:"service_list"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| ServiceList | [Service](#59-iap_service_information) Slice | M | Valid sessions for identity to establish. |

### 5.8 IAP_REGISTRATION_REJECT

```go
type RegistrationReject struct {
    RejectCause RejectCause `msgpack:"reject_cause"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| RejectCause | [RejectCause](#55-iap_reject_cause) | M | The cause of rejection. |

### 5.9 IAP_SERVICE_INFORMATION

```go
type SerivceInformation struct {
    Name string `msgpack:"name"`
    Description string `msgpack:"description,omitempty"`
    N3Endpoint N3Endpoint `msgpack:"n3_end_point"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| Name | string | M | The service name. |
| Description | string | O | The service description. |
| N3Endpoing | [N3Endpoint](#510-iap_n3_endpoint) | M | The actual SA-router access point information. |

### 5.10 IAP_N3_ENDPOINT

```go
type N3Endpoint struct {
    Address string `msgpack:"address"`
    Port int `msgpack:"port"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| Address | string | M | The SA-router address (IP address or hostname) for QUIC connection. |
| Port | int | M | The UDP port number for QUIC connection. |

### 5.11 IAP_DE_REGISTRATION_REQUEST

```go
type DeRegistrationRequest struct {
    IdentityInformation IdentityInformation `msgpack:"identity_information"`
    Certificate string `msgpack:"certificate"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| IdentityInformation | [IdentityInformation](#54-iap_identity_information) | M | Identity name setup at OAM. |
| Certificate | string | M | The certificate received from initialization procedure from PKF. |

### 5.12 IAP_DE_REGISTRATION_ACCEPT

```go
type DeRegistrationAccept struct{}
```

| Field | Type | Required | Description |
| - | - | - | - |

### 5.13 IAP_DE_REGISTRATION_REJECT

```go
type DeRegistrationReject struct{
    RejectCause RejectCause `msgpack:"reject_cause"`
}
```

| Field | Type | Required | Description |
| - | - | - | - |
| RejectCause | [RejectCause](#55-iap_reject_cause) | M | The cause of rejection. |
